__NOEDITSECTION__ __NOTOC__{{Developer Manual Navigator|chapter=Environment}}

The ''' Wiki Platform''' provides an environment to host multiple '''Wiki instances'''.

{{#tag:graphviz | digraph "TEAM Platform Overview" {
rankdir=TB;
newrank=true;
nodesep=0.3;
compound=true;

node [style="filled" fillcolor="#f9f9f9" color="#333333" shape = "record" fontname="Arial" fontsize=8 width="0.03" height="0.03"];
edge [color="#333333" arrowhead="normal" fontname="Arial" fontsize=8 fontcolor="#333333"];

nodeUser [ label="USER" shape="oval"];

subgraph clusterDesign {label = "Wiki Platform" style=dotted  color="brown" labeljust="l"
  nodeWebServer [ label="Web Server" fillcolor="#C6D729" shape="component"];
  nodeWikiInstance1 [ label="Wiki Instance (1)" fillcolor="#FFCC00" ];
  nodeWikiInstance2 [ label="Wiki Instance (2)" fillcolor="#FFCC00" ];
  nodeWikiInstance3 [ label="Wiki Instance (3)" fillcolor="#FFCC00" ];
  nodeWikiInstance4 [ label="Wiki Instance (4)" fillcolor="#FFCC00" ];
  nodeLDAP [ label="LDAP" fillcolor="#C6D729" shape="component"];
  nodeMaintenance [ label="Maintenance Scripts\n-------------------------\nCreate Wiki\nClone Wiki\n Delete Wiki\n Migrate Wiki\n Backup Wiki\n Restore Wiki\n-------------------------\nWiki Automation Tool\n-------------------------\nrunJobs\nrebuildData" fillcolor="#C6D729" shape="component"];
  nodeBackup [ label="Backups\n------------\nSQL\nRDF\nXML" fillcolor="#C296B6" shape="note"];
  nodeReportsEngine [ label="Reports Generator" fillcolor="#C6D729" shape="component"];
  nodeReports [ label="Reports" fillcolor="#C296B6" shape="note"];
  nodeCronTasks [ label="Cron Tasks" fillcolor="#ff9900" shape="cds"];
};

{rank=same nodeUser nodeWebServer nodeLDAP}
{rank=same nodeMaintenance nodeBackup}
{rank=same nodeCronTasks nodeReportsEngine nodeReports}

nodeUser -> nodeWebServer [label="accesses"];
nodeWebServer -> nodeWikiInstance1 [ label="/wiki1"];
nodeWebServer -> nodeWikiInstance2 [ label="/wiki2"];
nodeWebServer -> nodeWikiInstance3 [ label="/wiki3"];
nodeWebServer -> nodeWikiInstance4 [ label="/wiki4"];
nodeWebServer -> nodeLDAP [ label="authenticates users against"];

nodeWikiInstance1 -> nodeMaintenance [ label="is managed through" ]
nodeWikiInstance2 -> nodeMaintenance [ label="is managed through" ]
nodeWikiInstance3 -> nodeMaintenance [ label="is managed through" ]
nodeWikiInstance4 -> nodeMaintenance [ label="is managed through" ]

nodeMaintenance -> nodeBackup [ label="create (nightly)" ]
nodeBackup -> nodeReportsEngine [ label="is data source for"]
nodeReportsEngine -> nodeReports [ label="generates (nightly)"]

nodeCronTasks -> nodeMaintenance [ label="initiate" ]
nodeCronTasks -> nodeReportsEngine [ label="initiate" ]

} | format="png" | renderer="dot" }}

Each Wiki instance is accessible through a different url path.

An access to the Wiki instances is controlled by the '''Web Server''' and is allowed only to the users successfully authenticated to the '''LDAP directory'''.
Thus users who need an access to the Wiki instances have to be first registered in the LDAP directory.
Access to the specific Wiki instances might be further limited to the users assigned to a specific groups (by default all users have access to all Wiki instances).

The Wiki instances are managed through a set of '''Maintenance Scripts''', which allow to create clone, delete, backup and restore instances.

The platform provides the '''Report Generator''', which based on the Wiki data generates various '''Reports'''.

Backups and reports generation is automatically triggered every night.

<div style="clear:both"></div>

=Wiki instance=

The '''Wiki instances''' are implemented as a separate instances of '''MediaWiki''' web application.

{{#tag:graphviz | digraph "Wiki Instance Overview" {
rankdir=BT;
newrank=true;
nodesep=0.3;
compound=true;

node [style="filled" fillcolor="#f9f9f9" color="#333333" shape = "record" fontname="Arial" fontsize=8 width="0.03" height="0.03"];
edge [color="#333333" arrowhead="normal" fontname="Arial" fontsize=8 fontcolor="#333333"];

nodeWikiGenerator [ label="Wiki Automation Tool" shape="component" fillcolor="#C6D729"];

subgraph clusterDesign {label="Wiki instance" style=dotted  color="brown"
  nodeApplicationPages [ label="Application Pages" shape="note" fillcolor="#C296B6"];
  nodeDataPages [ label="Data Pages" shape="note" fillcolor="#C296B6"];
  nodeMediaWiki [ label="MediaWiki\nWeb Application" shape="component" fillcolor="#C6D729"];
  nodeSemanticMediaWiki [ label="Semantic MediaWiki\nExtension" shape="component" fillcolor="#9ACD32"];
  nodeMediaWikiExtensions [ label="MediaWiki\nExtensions" shape="component" fillcolor="#9ACD32" ];
  nodeSemanticMediaWikiExtensions [ label="Semantic MediaWiki\nExtensions" shape="component" fillcolor="#9ACD32" ];
}

nodeUser [ label="USERS and Import Scripts" shape="oval"];

nodeSemanticMediaWiki -> nodeMediaWiki [label="extends" arrowhead="empty"];
nodeMediaWikiExtensions -> nodeMediaWiki [ label="extends" arrowhead="empty"];
nodeSemanticMediaWikiExtensions -> nodeSemanticMediaWiki [ label="extends" arrowhead="empty"];
nodeMediaWiki -> nodeApplicationPages [label="hosts"];
nodeMediaWiki -> nodeDataPages [label="hosts"];
nodeApplicationPages -> nodeDataPages [label="render"];
nodeWikiGenerator -> nodeApplicationPages [label="generates"]
nodeUser -> nodeDataPages [label="create"]

{rank=same nodeWikiGenerator nodeApplicationPages nodeDataPages nodeUser}

} | format="png" | renderer="dot" }}

The Wiki Platform extends standard MediaWiki application by deploying several '''MediaWiki Extensions''', including '''Semantic MediaWiki Extension''' (and its further extensions).
The list of extensions include publicly available ones and some developed internally by ACT.

The Wiki instance hosts '''Application Pages''' and '''Data Pages'''.

Application Pages include Templates, Forms, Categories, etc. and are primarily used to create and render Data Pages.
Application Pages are in most cases created and deployed by the Wiki Automation Tool.

Data Pages are created manually by the users (through the generated forms) or imported automatically by the import scripts.

=Installation=
The Wiki Platform can be installed directly on a '''[[#Physical Hardware|Physical Hardware]]''' or in a '''[[#Virtual Environment|Virtual Environment]]'''.

Upon completion of the physical or virtual Wiki Platform installation, the environment contains all required software components to run Wiki instances, but '''no Wiki instance is created at this time'''.

To create a new Wiki instances use maintenance scripts described in the '''[[#Wiki Management|Wiki Management]]''' section.

To recreate the Wiki instances currently used in the ACT TIDE Cluster follow the instructions in the '''[[#ACT TIDE Cluster|ACT TIDE Cluster]]''' section.

==Physical Hardware==
* install basic/minimalistic operating system. The TEAM Collaboration Platform currently supports only '''Ubuntu 16.04''' and it is recommended to start with a minimal Ubuntu variant from [https://help.ubuntu.com/community/Installation/MinimalCD Ubuntu Minimal CD].
* check out the TEAM Collaboration Platform source code:  ''"git clone <nowiki>https://github.com/goossens/Wikis.git</nowiki>"''
* run installer: ''"sudo bash InstallServer.sh"'' in the ''"Wikis/Install"'' folder

==Virtual Environment==
The TEAM Collaboration Platform provides scripts to automatically provision a Virtual Machine with Wiki Platform (in VirtualBox environment).

* download and install VirtualBox (from https://www.virtualbox.org)
* download and install Vagrant (from https://www.vagrantup.com/downloads.html)
* check out the TEAM Collaboration Platform source code:  ''"git clone <nowiki>https://github.com/goossens/Wikis.git</nowiki>"''
* create minimal Ubuntu 16.04 image (box) for VirtualBox
** download and install Packer (from https://www.packer.io). If you're using OS X and Homebrew, you can install Packer through: ''"brew install packer"''
** configure required disk space. If you're planning to create a site which will manage large amount of data (like a copy of Tidepedia and EM) increase the disk size in a ''"Ubuntu16.04.json"'' file in the ''"Wikis/Vagrant/Packer/"'' folder. Default value is 10GB. Find and update the value of ''"disk_size"'' property, eg: "disk_size" : 30720
** build new Box, by running: ''"sudo bash ./BuildAndInstallBox.sh"'' in the ''"Wikis/Vagrant/Packer/"'' folder
* create VM with Wiki Platform
** run ''"vagrant up"'' in the ''"Wikis/Vagrant/Server/"'' folder. This will create a VM  accessible at 192.168.20.11 from the host.
** install the Wiki Platform: type ''"vagrant ssh"'' to enter the guest environment and then run ''"sudo bash InstallServer.sh"'' in the ''"/var/Wikis/Install/"'' folder.

==ACT TIDE Cluster==

To instantiate the Wiki instances currently used by the ACT TIDE cluster run ''"sudo bash InstallACT.sh"'' in the ''"Wikis/Install"'' folder.

This will create instances of Tidepedia, EM Wiki, CWIX Wiki, THF Wiki, Bugzilla, with NO DATA.

In order to recreate the most current data:
* download ''"<nowiki>https://tide.act.nato.int/backups/${WIKI}.sql</nowiki>"'' and ''"<nowiki>https://tide.act.nato.int/backups/${WIKI}.tgz</nowiki>"'' to ''""/var/backup/team"'' folder.
* run ''"sudo bash /team/Tools/MediaWiki/RestoreWiki.sh ${WIKI}''


=Wiki Management=
The TEAM Wiki Platform provides several scripts to manage Wiki instances:
* '''CreateWiki''' to create a new (empty) Wiki instance
* '''CloneWiki''' to create a new Wiki instance as a clone of another existing Wiki instance
* '''DeleteWiki''' to delete existing Wiki instance (all pages, data and files will be removed)
* '''BackupWiki''' to create a backup of existing Wiki instance (SQL, RDF and XML formats). Backups are created in the ''"/var/backups/team"'' folder.
* '''RestoreWiki''' to restore existing Wiki instance from its backup. Backup files are read from the ''"/var/backups/team"'' folder.
* '''MigrateWiki''' to migrate Wiki instance restored from a backup, created in the older version of the MediaWiki platform to the current version


In order to create a NEW instance of the Wiki (e.g. TEST WIKI):
* run: ''"sudo bash /team/Tools/MediaWiki/CreateWiki test TEST"''
* restart apache server: ''"service apache2 restart"''


The platform configures several '''periodical tasks''':
* to create backups of all Wiki instances (every night)
* to generate Reports (every night)
* to run required MediaWiki maintenance tasks (e.g. runJobs every 10 minutes)


=Wiki Configuration=

==Change Wiki Logo==
* Upload required wiki logo file (135 x 135 pixels) to the /var/www/html/{WIKI}/images folder.
* Update LocalSettings.php: $wgLogo = "$wgScriptPath/images/{LOGO FILE NAME}";

==Create Bureaucrat Account==
When deploying pages to the server the Wiki Automation Tool authenticates itself using required authentication method

The account which is used, has to have '''bureaucrat''' privileges in the target Wiki instance.

The '''bureaucrat''' account might be created invoking PHP maintenance script in the $WIKI_HOME/maintenance folder:
  php createAndPromote.php --bureaucrat --sysop --force {USERNAME}


=Wiki Content=
The ''"CreateWiki"'' script creates an '''empty''' Wiki instance (with no pages).
The '''Wiki Automation Tool''' (another set of scripts) might be used to create and maintain the '''Wiki content'''
by automatically generating '''Application Pages''' from the '''Wiki Model''' (the xml file with detailed definition of desired '''Data Model''').
Generated pages are automatically deployed to the Wiki instance and allow user to add, modify, view and search data for all defined '''Concepts'''.
See '''[[Help:Wiki Automation Tool|Wiki Automation Tool]]''' for more details.


=User Management=
The platform installs LDAP server which is a default user repository.

New users which require an access to the Wiki instances shall be added to that repository.

There are two ways to add new users:
* use LDAP Account Manager (LAM) web interface (<nowiki>http://$PLATFORM_IP/lam</nowiki>)
* LDAP command line (ldapadd, ldapmodify, ldappasswd, etc.)

<headertabs />
